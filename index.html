<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AC Milan 2024-2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Visualization & Content Choices: 
        - Revenue/Sponsorship Breakdown: Goal: Show proportions. Method: Donut Chart (Chart.js). Interaction: Hover. Justification: Clear for part-to-whole analysis.
        - Performance Overview: Goal: Compare. Method: Custom HTML/Tailwind trophy case. Interaction: Static visual. Justification: Provides a quick, impactful summary of the season's contrasting results.
        - Squad Data: Goal: Organize & Compare. Method: Filterable/Sortable HTML Table (JS). Interaction: Filter, Sort, Click for detail. Justification: The most effective method for exploring and comparing a large roster of players.
        - Detailed Player Stats: Goal: Organize & Compare metrics for one player. Method: Radar Chart (Chart.js). Interaction: Hover. Justification: Excellent for multivariate comparison on a single entity.
        - Coaching Timeline: Goal: Show change. Method: HTML/Tailwind diagram. Interaction: Static visual. Justification: Clearly illustrates instability.
        All visualizations are rendered on Canvas via Chart.js, with textual content presented in styled cards for context. -->
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 320px; max-height: 40vh; }
        @media (min-width: 768px) { .chart-container { height: 400px; } }
        .nav-link { transition: color 0.3s, border-color 0.3s; }
        .nav-link.active { color: #E53935; border-bottom-color: #E53935; }
        .nav-link:not(.active) { border-bottom-color: transparent; }
        .modal-backdrop { transition: opacity 0.3s ease-in-out; }
        .modal-content { transition: transform 0.3s ease-in-out; }
        .table-header-sortable { cursor: pointer; }
        .table-header-sortable:hover { background-color: #f0f0f0; }
        .table-row-clickable { cursor: pointer; transition: background-color 0.2s; }
        .table-row-clickable:hover { background-color: #fcebeb; }
        .tournament-logo { width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; color: white; margin-right: 8px; }
        .serie-a-logo { background-color: #0055A4; } /* Blue for Serie A */
        .champions-league-logo { background-color: #001E5A; } /* Dark blue for UCL */
        .coppa-italia-logo { background-color: #009246; } /* Green for Coppa Italia */
        .supercoppa-logo { background-color: #CEB888; } /* Gold for Supercoppa */

        .timeline { list-style-type: none; padding-left: 0; position: relative; }
        .timeline:before { content: ''; background: #d4d9df; display: inline-block; position: absolute; left: 10px; width: 2px; height: 100%; z-index: 0; }
        .timeline-item { margin: 20px 0; padding-left: 40px; position: relative; }
        .timeline-item:before { content: ''; background: white; border: 2px solid #E53935; display: inline-block; position: absolute; border-radius: 50%; left: 0px; width: 24px; height: 24px; z-index: 1; text-align: center; line-height: 20px; font-size: 12px; }
        .timeline-item-content { background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .timeline-item-title { font-weight: bold; margin-bottom: 5px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <img src="https://placehold.co/40x40/FF0000/FFFFFF?text=ACM" alt="AC Milan Logo" class="h-8 w-8 rounded-full">
                    <h1 class="text-lg md:text-xl font-bold text-slate-900">Milan 2024-25</h1>
                </div>
                <div class="hidden md:flex items-center space-x-2 md:space-x-4">
                    <a href="#overview" data-target="overview" class="nav-link text-sm md:text-base font-medium text-slate-600 hover:text-red-600 py-2 border-b-2">📄 Tổng Quan</a>
                    <a href="#performance" data-target="performance" class="nav-link text-sm md:text-base font-medium text-slate-600 hover:text-red-600 py-2 border-b-2">📊 Thành Tích</a>
                    <a href="#off-pitch" data-target="off-pitch" class="nav-link text-sm md:text-base font-medium text-slate-600 hover:text-red-600 py-2 border-b-2">💼 Tài Chính & Hậu Trường</a>
                    <a href="#squad" data-target="squad" class="nav-link text-sm md:text-base font-medium text-slate-600 hover:text-red-600 py-2 border-b-2">👥 Đội Hình</a>
                </div>
                <div class="md:hidden">
                    <select id="mobile-nav" class="bg-gray-200 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 block w-full p-2.5">
                        <option value="overview">📄 Tổng Quan</option>
                        <option value="performance">📊 Thành Tích</option>
                        <option value="off-pitch">💼 Tài Chính & Hậu Trường</option>
                        <option value="squad">👥 Đội Hình</option>
                    </select>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        
        <section id="overview" class="app-section space-y-8">
            <div>
                <h2 class="text-3xl font-bold text-slate-900 flex items-center"><span class="mr-2 text-2xl">📄</span>Mùa Giải Của Những Thái Cực</h2>
                <p class="mt-2 text-lg text-slate-600">Mùa giải 2024-2025 của AC Milan là một bức tranh phức tạp, nơi vinh quang tại các giải đấu cúp không thể che lấp đi nỗi thất vọng tại Serie A. Báo cáo này phân tích sâu về một năm đầy biến động của Rossoneri, từ sân cỏ đến phòng họp.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <h3 class="font-semibold text-slate-500 flex items-center"><div class="tournament-logo serie-a-logo">SA</div>Vị trí Serie A</h3>
                    <p class="text-4xl font-bold text-red-700 mt-2">Hạng 8</p>
                    <p class="text-sm text-slate-500 mt-1">Không đủ điều kiện dự cúp Châu Âu</p>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <h3 class="font-semibold text-slate-500 flex items-center"><div class="tournament-logo supercoppa-logo">SI</div>Supercoppa Italiana</h3>
                    <p class="text-4xl font-bold text-green-600 mt-2">Vô Địch</p>
                    <p class="text-sm text-slate-500 mt-1">Đánh bại Inter Milan 3-2</p>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <h3 class="font-semibold text-slate-500">Vua Phá Lưới (Mọi Đấu Trường)</h3>
                    <p class="text-4xl font-bold text-slate-800 mt-2">17</p>
                    <p class="text-sm text-slate-500 mt-1">Christian Pulisic</p>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <h3 class="font-semibold text-slate-500">Giá Trị CLB (Forbes 2025)</h3>
                    <p class="text-4xl font-bold text-slate-800 mt-2">$1.5 tỷ</p>
                    <p class="text-sm text-green-600 mt-1">▲ 5% so với năm trước</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-2xl font-bold mb-4">Sự Tương Phản Của Mùa Giải</h3>
                <p class="mb-6 text-slate-600">Thành công ở các giải đấu cúp một trận và sự bất ổn trong cuộc đua đường dài ở giải VĐQG đã định hình nên một mùa giải khó đoán của Milan. Đội bóng có thể thi đấu thăng hoa trong các trận đấu knock-out nhưng lại thiếu đi sự nhất quán cần thiết để cạnh tranh cho Scudetto, dẫn đến sự hụt hẫng lớn cho người hâm mộ.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="border-l-4 border-green-500 pl-4">
                        <h4 class="font-bold text-xl text-green-600">Điểm Sáng</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1 text-slate-700">
                            <li>Vô địch Supercoppa Italiana lần thứ 8.</li>
                            <li>Lọt vào chung kết Coppa Italia.</li>
                            <li>Christian Pulisic và Tijjani Reijnders tỏa sáng.</li>
                            <li>Tiếp tục trao cơ hội cho các tài năng trẻ.</li>
                            <li>Bất bại trước Inter Milan ở các trận derby.</li>
                        </ul>
                    </div>
                    <div class="border-l-4 border-red-500 pl-4">
                        <h4 class="font-bold text-xl text-red-600">Nỗi Thất Vọng</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1 text-slate-700">
                            <li>Chỉ kết thúc ở vị trí thứ 8 tại Serie A.</li>
                            <li>Bị loại sớm khỏi Champions League.</li>
                            <li>Thua chung kết Coppa Italia trước Bologna.</li>
                            <li>Bất ổn trên băng ghế huấn luyện.</li>
                        </ul>
                    </div>
                </div>
            </div>

        </section>

        <section id="performance" class="app-section space-y-8 hidden">
             <div>
                <h2 class="text-3xl font-bold text-slate-900 flex items-center"><span class="mr-2 text-2xl">📊</span>Phân Tích Thành Tích</h2>
                <p class="mt-2 text-lg text-slate-600">Khám phá hành trình của AC Milan qua bốn đấu trường chính trong mùa giải 2024-2025: từ vinh quang cúp quốc nội đến sự sa sút ở giải VĐQG và đấu trường châu Âu.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-1 flex items-center"><div class="tournament-logo serie-a-logo">SA</div>Serie A: Mùa Giải Đầy Thử Thách</h3>
                    <p class="text-slate-600 mb-4">Kết thúc ở vị trí thứ 8 với 63 điểm là một kết quả đáng thất vọng, cho thấy sự thiếu ổn định nghiêm trọng trong suốt 38 vòng đấu.</p>
                    <div class="chart-container">
                        <canvas id="serieAChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><div class="tournament-logo champions-league-logo">CL</div>Champions League: Dừng Bước Sớm</h3>
                    <p class="text-slate-600 mb-4">Dù đã vượt qua vòng bảng, Milan đã bị Feyenoord loại ở vòng play-off, một kết quả dưới kỳ vọng cho một CLB giàu truyền thống châu Âu.</p>
                    <div class="flex flex-col space-y-4">
                        <div class="text-center p-4 bg-slate-100 rounded-lg">
                            <p class="font-semibold text-slate-500">Giai đoạn</p>
                            <p class="text-xl font-bold text-slate-800">Vòng Play-off Đấu loại trực tiếp</p>
                        </div>
                        <div class="text-center p-4 bg-red-50 rounded-lg">
                            <p class="font-semibold text-red-500">Kết quả</p>
                            <p class="text-xl font-bold text-red-800">Bị loại bởi Feyenoord (Tổng tỷ số 1-2)</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><div class="tournament-logo coppa-italia-logo">CI</div>Coppa Italia: Hành Trình Đến Chung Kết</h3>
                     <p class="text-slate-600 mb-4">Milan đã thể hiện bản lĩnh ở các trận đấu loại trực tiếp, vượt qua các đối thủ mạnh để vào chung kết, nhưng lại gục ngã ở ngưỡng cửa thiên đường.</p>
                     <ul class="timeline">
                        <li class="timeline-item">
                            <div class="timeline-item-content">
                                <h4 class="timeline-item-title">Vòng 16 đội</h4>
                                <p>vs Sassuolo <strong class="text-green-600">(Thắng 6-1)</strong></p>
                            </div>
                        </li>
                        <li class="timeline-item">
                            <div class="timeline-item-content">
                                <h4 class="timeline-item-title">Tứ kết</h4>
                                <p>vs AS Roma <strong class="text-green-600">(Thắng 3-1)</strong></p>
                            </div>
                        </li>
                        <li class="timeline-item">
                            <div class="timeline-item-content">
                                <h4 class="timeline-item-title">Bán kết</h4>
                                <p>vs Inter Milan <strong class="text-green-600">(Thắng chung cuộc 4-1)</strong></p>
                            </div>
                        </li>
                        <li class="timeline-item">
                            <div class="timeline-item-content">
                                <h4 class="timeline-item-title">Chung kết</h4>
                                <p>vs Bologna <strong class="text-red-600">(Thua 0-1)</strong></p>
                            </div>
                        </li>
                    </ul>
                </div>
                 <div class="bg-white p-6 rounded-xl shadow-md flex flex-col">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><div class="tournament-logo supercoppa-logo">SI</div>Supercoppa Italiana: Tia Sáng An Ủi</h3>
                    <p class="text-slate-600 mb-4">Chiến thắng thuyết phục trước đại kình địch Inter Milan đã mang về danh hiệu duy nhất của mùa giải, một niềm vui hiếm hoi cho các Milanista.</p>
                     <div class="flex-grow flex flex-col items-center justify-center text-center p-4 bg-amber-50 rounded-lg">
                        <span class="text-6xl text-amber-500">🏆</span>
                        <p class="text-3xl font-bold text-slate-800 mt-4">VÔ ĐỊCH</p>
                        <p class="text-lg text-slate-600">Đánh bại Inter Milan 3-2</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="off-pitch" class="app-section space-y-8 hidden">
            <div>
                <h2 class="text-3xl font-bold text-slate-900 flex items-center"><span class="mr-2 text-2xl">💼</span>Tài Chính & Hậu Trường</h2>
                <p class="mt-2 text-lg text-slate-600">Những biến động trên sân cỏ song hành cùng các vấn đề về tài chính và mối quan hệ căng thẳng với người hâm mộ. Khám phá những động lực ngoài sân cỏ định hình mùa giải của Milan.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-1">Sức Khỏe Kinh Tế</h3>
                    <p class="text-slate-600 mb-4">Dù giá trị CLB tăng, việc không được dự cúp Châu Âu mùa tới sẽ tạo ra áp lực tài chính lớn, dự kiến gây thâm hụt đáng kể.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="p-4 bg-slate-100 rounded-lg">
                            <h4 class="font-medium text-slate-500">Doanh thu 2023-24</h4>
                            <p class="text-2xl font-bold text-slate-800">€397.6M</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg">
                            <h4 class="font-medium text-red-500">Lỗ dự kiến 24-25</h4>
                            <p class="text-2xl font-bold text-red-700">~ €25M</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-1">Mối Quan Hệ với Người Hâm Mộ</h3>
                    <p class="text-slate-600 mb-4">Sự bất mãn lên đến đỉnh điểm với các cuộc biểu tình của Curva Sud nhắm vào chủ sở hữu RedBird, phản ánh sự mất kết nối giữa CĐV và ban lãnh đạo.</p>
                    <blockquote class="border-l-4 border-black pl-4 py-2 bg-gray-100">
                        <p class="text-xl font-semibold italic text-slate-800">"Go Home"</p>
                        <footer class="text-slate-600 mt-2">— Thông điệp từ các Ultras trong trận đấu cuối cùng của mùa giải.</footer>
                    </blockquote>
                    <h4 class="font-semibold mt-6 mb-2">Các bất bình chính:</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-700">
                        <li>Thành tích mùa giải đáng thất vọng.</li>
                        <li>Thiếu đầu tư và tham vọng rõ ràng từ chủ sở hữu.</li>
                        <li>Sa thải huyền thoại Paolo Maldini.</li>
                        <li>Sự mất kết nối với bản sắc CLB.</li>
                    </ul>
                </div>
            </div>
             <div class="bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-2xl font-bold mb-4">Ban Huấn Luyện: Chiếc Ghế Nóng</h3>
                 <p class="text-slate-600 mb-6">Sự bất ổn ở vị trí HLV là một trong những nguyên nhân chính dẫn đến thành tích kém cỏi. Việc thay tướng giữa dòng và công bố HLV mới cho mùa sau ngay lập tức cho thấy sự thiếu kiên nhẫn và tầm nhìn dài hạn.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-center text-center">
                    <div>
                        <img src="https://placehold.co/100x100/EEEEEE/333333?text=Fonseca" alt="Paulo Fonseca" class="w-24 h-24 mx-auto rounded-full mb-2 object-cover">
                        <b class="block">Paulo Fonseca</b>
                        <span class="text-xs text-slate-600">Đầu mùa giải - 29/12/2024</span>
                    </div>
                    <div class="text-2xl text-slate-400 hidden md:block">&rarr;</div>
                    <div class="md:hidden text-2xl text-slate-400 my-2">&darr;</div>
                    <div>
                        <img src="https://placehold.co/100x100/EEEEEE/333333?text=Conceição" alt="Sérgio Conceição" class="w-24 h-24 mx-auto rounded-full mb-2 object-cover">
                        <b class="block">Sérgio Conceição</b>
                        <span class="text-xs text-slate-600">30/12/2024 - Cuối mùa giải</span>
                    </div>
                    <div class="text-2xl text-slate-400 hidden md:block">&rarr;</div>
                     <div class="md:hidden text-2xl text-slate-400 my-2">&darr;</div>
                    <div>
                        <img src="https://placehold.co/100x100/E53935/FFFFFF?text=Allegri" alt="Massimiliano Allegri" class="w-24 h-24 mx-auto rounded-full mb-2 object-cover border-2 border-red-600">
                        <b class="block">Massimiliano Allegri</b>
                        <span class="text-xs text-slate-600">Bổ nhiệm cho mùa 2025/26</span>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-2xl font-bold mb-4">Thành Phần Ban Lãnh Đạo (Tính đến 02/06/2025)</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tên</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Chức Vụ/Vai Trò</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Liên Kết</th>
                            </tr>
                        </thead>
                        <tbody id="management-table-body" class="bg-white divide-y divide-gray-200">
                            
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="squad" class="app-section space-y-8 hidden">
            <div>
                <h2 class="text-3xl font-bold text-slate-900 flex items-center"><span class="mr-2 text-2xl">👥</span>Phân Tích Đội Hình</h2>
                <p class="mt-2 text-lg text-slate-600">Khám phá chi tiết từng cầu thủ trong đội hình AC Milan mùa giải 2024-2025. Sử dụng bộ lọc để xem theo vị trí và sắp xếp theo các chỉ số khác nhau. Nhấp vào một cầu thủ để xem phân tích sâu hơn.</p>
            </div>
            <div class="bg-white p-4 sm:p-6 rounded-xl shadow-md">
                <div class="flex flex-col sm:flex-row items-center justify-between mb-4 gap-4">
                    <div class="w-full sm:w-auto">
                        <label for="position-filter" class="text-sm font-medium text-slate-700 mr-2">Lọc theo vị trí:</label>
                        <select id="position-filter" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 p-2">
                            <option value="all">Tất cả</option>
                            <option value="GK">Thủ môn (GK)</option>
                            <option value="DF">Hậu vệ (DF)</option>
                            <option value="MF">Tiền vệ (MF)</option>
                            <option value="FW">Tiền đạo (FW)</option>
                        </select>
                    </div>
                     <div class="w-full sm:w-auto">
                        <input type="text" id="name-search" placeholder="Tìm kiếm theo tên..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 p-2 w-full">
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-slate-500">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                            <tr>
                                <th scope="col" class="px-6 py-3 table-header-sortable" data-sort="name">Cầu thủ</th>
                                <th scope="col" class="px-6 py-3 table-header-sortable hidden md:table-cell" data-sort="age">Tuổi</th>
                                <th scope="col" class="px-6 py-3 table-header-sortable" data-sort="appearances">Số trận</th>
                                <th scope="col" class="px-6 py-3 table-header-sortable" data-sort="goals">Bàn thắng</th>
                                <th scope="col" class="px-6 py-3 table-header-sortable" data-sort="value">Giá trị TT (€M)</th>
                            </tr>
                        </thead>
                        <tbody id="squad-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <div id="player-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center hidden modal-backdrop">
        <div class="bg-slate-50 rounded-xl shadow-2xl w-11/12 max-w-4xl max-h-[90vh] overflow-y-auto m-8 modal-content transform scale-95">
            <div class="sticky top-0 bg-slate-50 p-4 border-b border-slate-200 flex justify-between items-center z-10">
                <h3 id="modal-player-name" class="text-2xl font-bold"></h3>
                <button id="close-modal-btn" class="text-slate-500 hover:text-slate-800 text-3xl leading-none">&times;</button>
            </div>
            <div id="modal-body" class="p-6 space-y-6">
            </div>
        </div>
    </div>

    <script>
        const AppData = {
            squad: [
                { id: 1, name: 'Mike Maignan', position: 'GK', age: 29, appearances: 53, goals: 0, assists: 0, value: 25.0, nationality: 'Pháp', contractUntil: '2026', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Maignan', stats: {cleanSheets: 15, goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 2, name: 'Marco Sportiello', position: 'GK', age: 33, appearances: 3, goals: 0, assists: 0, value: 0.5, nationality: 'Ý', contractUntil: '2027', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Sportiello', stats: {cleanSheets: 0, goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 3, name: 'Lorenzo Torriani', position: 'GK', age: 20, appearances: 2, goals: 0, assists: 0, value: 0.1, nationality: 'Ý', contractUntil: '2027', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Torriani', stats: {cleanSheets: 0, goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 4, name: 'Théo Hernandez', position: 'DF', age: 27, appearances: 49, goals: 5, assists: 4, value: 40.0, nationality: 'Pháp', contractUntil: '2026', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Theo+H.', stats: {goals: 5, assists: 4, xG:3.17, xA:5.34, keyPasses:0, tackles:60, interceptions:35} },
                { id: 5, name: 'Álex Jiménez', position: 'DF', age: 20, appearances: 28, goals: 0, assists: 2, value: 10.0, nationality: 'Tây Ban Nha', contractUntil: '2028', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Jimenez', stats: {goals: 0, assists: 2, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 6, name: 'Emerson Royal', position: 'DF', age: 26, appearances: 26, goals: 0, assists: 0, value: 10.0, nationality: 'Brazil', contractUntil: '2028', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Emerson', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 7, name: 'Fikayo Tomori', position: 'DF', age: 27, appearances: 36, goals: 0, assists: 2, value: 20.0, nationality: 'Anh', contractUntil: '2027', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Tomori', stats: {goals: 0, assists: 2, xG:0.1, xA:0.43, keyPasses:0, tackles:55, interceptions:45} },
                { id: 8, name: 'Alessandro Florenzi', position: 'DF', age: 34, appearances: 1, goals: 0, assists: 0, value: 1.0, nationality: 'Ý', contractUntil: '2025', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Florenzi', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 9, name: 'Malick Thiaw', position: 'DF', age: 23, appearances: 31, goals: 1, assists: 0, value: 20.0, nationality: 'Đức', contractUntil: '2027', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Thiaw', stats: {goals: 1, assists: 0, xG:0, xA:0.2, keyPasses:0, tackles:40, interceptions:30} },
                { id: 10, name: 'Strahinja Pavlović', position: 'DF', age: 24, appearances: 35, goals: 2, assists: 0, value: 18.0, nationality: 'Serbia', contractUntil: '2028', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Pavlovic', stats: {goals: 2, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 11, name: 'Kyle Walker', position: 'DF', age: 35, appearances: 16, goals: 0, assists: 0, value: 5.0, nationality: 'Anh', contractUntil: '2025', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Walker', note: 'Cho mượn (Man City)', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 12, name: 'Davide Bartesaghi', position: 'DF', age: 19, appearances: 7, goals: 0, assists: 0, value: 1.5, nationality: 'Ý', contractUntil: '2026', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Bartesaghi', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 13, name: 'Filippo Terracciano', position: 'DF', age: 22, appearances: 17, goals: 0, assists: 0, value: 7.0, nationality: 'Ý', contractUntil: '2029', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Terracciano', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 14, name: 'Matteo Gabbia', position: 'DF', age: 25, appearances: 36, goals: 2, assists: 0, value: 8.0, nationality: 'Ý', contractUntil: '2029', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Gabbia', stats: {goals: 2, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 15, name: 'Ruben Loftus-Cheek', position: 'MF', age: 29, appearances: 28, goals: 0, assists: 0, value: 16.0, nationality: 'Anh', contractUntil: '2027', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Loftus-C', stats: {goals: 0, assists: 0, xG:0.7, xA:1.9, keyPasses:20, tackles:0, interceptions:0} },
                { id: 16, name: 'Tijjani Reijnders', position: 'MF', age: 26, appearances: 54, goals: 15, assists: 6, value: 50.0, nationality: 'Hà Lan', contractUntil: '2027', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Reijnders', stats: {goals: 15, assists: 6, xG:7.5, xA:5.0, keyPasses:117, tackles:0, interceptions:0} },
                { id: 17, name: 'Youssouf Fofana', position: 'MF', age: 25, appearances: 52, goals: 1, assists: 8, value: 30.0, nationality: 'Pháp', contractUntil: '2028', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Fofana', stats: {goals: 1, assists: 8, xG:1.5, xA:4.0, keyPasses:45, tackles:0, interceptions:0} },
                { id: 18, name: 'Mattia Liberali', position: 'MF', age: 18, appearances: 1, goals: 0, assists: 0, value: 0.5, nationality: 'Ý', contractUntil: '2027', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Liberali', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 19, name: 'Warren Bondo', position: 'MF', age: 21, appearances: 5, goals: 0, assists: 0, value: 10.0, nationality: 'Pháp', contractUntil: '2029', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Bondo', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 20, name: 'Yunus Musah', position: 'MF', age: 22, appearances: 40, goals: 0, assists: 0, value: 22.0, nationality: 'Mỹ', contractUntil: '2028', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Musah', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 21, name: 'Santiago Giménez', position: 'FW', age: 24, appearances: 19, goals: 6, assists: 3, value: 37.0, nationality: 'Mexico', contractUntil: '2029', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Gimenez', stats: {goals: 6, assists: 3, xG:4.8, xA:0.9, keyPasses:15, tackles:0, interceptions:0} },
                { id: 22, name: 'Luka Jović', position: 'FW', age: 27, appearances: 17, goals: 4, assists: 0, value: 2.5, nationality: 'Serbia', contractUntil: '2025', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Jovic', stats: {goals: 4, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 23, name: 'Rafael Leão', position: 'FW', age: 26, appearances: 49, goals: 12, assists: 9, value: 75.0, nationality: 'Bồ Đào Nha', contractUntil: '2028', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Leao', stats: {goals: 12, assists: 9, xG:7.6, xA:8.4, keyPasses:70, tackles:0, interceptions:0} },
                { id: 24, name: 'Christian Pulisic', position: 'FW', age: 26, appearances: 50, goals: 17, assists: 11, value: 50.0, nationality: 'Mỹ', contractUntil: '2027', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Pulisic', stats: {goals: 17, assists: 11, xG:12.0, xA:6.4, keyPasses:60, tackles:0, interceptions:0} },
                { id: 25, name: 'Samuel Chukwueze', position: 'FW', age: 26, appearances: 36, goals: 5, assists: 0, value: 14.0, nationality: 'Nigeria', contractUntil: '2028', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Chukwueze', stats: {goals: 5, assists: 0, xG:4.5, xA:1.5, keyPasses:25, tackles:0, interceptions:0} },
                { id: 26, name: 'Francesco Camarda', position: 'FW', age: 17, appearances: 14, goals: 0, assists: 0, value: 10.0, nationality: 'Ý', contractUntil: '2027', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Camarda', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 27, name: 'Bob Murphy Omoregbe', position: 'FW', age: 21, appearances: 1, goals: 0, assists: 0, value: 0.2, nationality: 'Ý', contractUntil: '2025', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Omoregbe', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 28, name: 'João Félix', position: 'FW', age: 25, appearances: 21, goals: 3, assists: 0, value: 25.0, nationality: 'Bồ Đào Nha', contractUntil: '2025', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Felix', note: 'Cho mượn (Chelsea)', stats: {goals: 3, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
                { id: 29, name: 'Tammy Abraham', position: 'FW', age: 27, appearances: 44, goals: 10, assists: 0, value: 15.0, nationality: 'Anh', contractUntil: '2025', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Abraham', note: 'Cho mượn (Roma)', stats: {goals: 10, assists: 0, xG:12.5, xA:2.1, keyPasses:20, tackles:0, interceptions:0} },
                { id: 30, name: 'Riccardo Sottil', position: 'FW', age: 26, appearances: 8, goals: 0, assists: 0, value: 4.0, nationality: 'Ý', contractUntil: '2025', photoUrl: 'https://placehold.co/150x150/DDDDDD/555555?text=Sottil', note: 'Cho mượn (Fiorentina)', stats: {goals: 0, assists: 0, xG:0, xA:0, keyPasses:0, tackles:0, interceptions:0} },
            ],
            performance: {
                serieA: {
                    labels: ['Mục tiêu Top 4', 'AC Milan', 'Atalanta (Thứ 7)', 'Bologna (Thứ 6)'],
                    points: [71, 63, 69, 68]
                }
            },
            finance: {
                revenue: {
                    labels: ['Thương mại (44%)', 'Bản quyền TH (38%)', 'Ngày thi đấu (18%)'],
                    data: [174.9, 151.1, 71.6]
                }
            },
            management: [
                { name: 'Paolo Scaroni', role: 'Chủ tịch', affiliation: 'AC Milan' },
                { name: 'Giorgio Furlani', role: 'Giám đốc Điều hành (CEO)', affiliation: 'AC Milan (trước đây thuộc quỹ Elliott)' },
                { name: 'Gerry Cardinale', role: 'Thành viên HĐQT', affiliation: 'RedBird Capital Partners' },
                { name: 'Randy Levine', role: 'Thành viên HĐQT', affiliation: 'RedBird Capital Partners' },
                { name: 'Mark Dowley', role: 'Thành viên HĐQT', affiliation: 'RedBird Capital Partners' },
                { name: 'Robert Klein', role: 'Thành viên HĐQT', affiliation: 'RedBird Capital Partners' },
                { name: 'David Castelblanco', role: 'Thành viên HĐQT', affiliation: 'RedBird Capital Partners' },
                { name: 'Gordon Singer', role: 'Thành viên HĐQT', affiliation: 'Elliott Management' },
                { name: 'Dominic Mitchell', role: 'Thành viên HĐQT', affiliation: 'Elliott Management' },
                { name: 'Stefano Cocirio', role: 'Thành viên HĐQT/Giám đốc Tài chính (CFO)', affiliation: 'AC Milan (trước đây thuộc quỹ Elliott)' },
                { name: 'Alfredo Craca', role: 'Thành viên HĐQT', affiliation: 'AC Milan' },
                { name: 'Riccardo Stefanelli', role: 'Thành viên HĐQT (Độc lập)', affiliation: 'Bổ nhiệm bởi RedBird' },
                { name: 'Franco Baresi', role: 'Phó Chủ tịch Danh dự', affiliation: 'AC Milan' },
                { name: 'Geoffrey Moncada', role: 'Giám đốc Kỹ thuật', affiliation: 'AC Milan' },
                { name: 'Maikel Oettle', role: 'Giám đốc Thương mại', affiliation: 'AC Milan' },
                { name: 'Francesca Montini', role: 'Giám đốc Thương hiệu', affiliation: 'AC Milan' }
            ]
        };

        let currentSort = { column: 'name', direction: 'asc' };
        let charts = {};

        function formatValue(value) {
            if (typeof value === 'number') return value.toFixed(1);
            return 'N/A';
        }
        
        function renderSquadTable(squadData) {
            const tableBody = document.getElementById('squad-table-body');
            tableBody.innerHTML = '';

            const sortedData = [...squadData].sort((a, b) => {
                let aVal = a[currentSort.column];
                let bVal = b[currentSort.column];
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                } else if (typeof aVal === 'number' && typeof bVal === 'number') {
                    // standard number sort
                } else { // handle cases where one might be undefined or not a number
                    if (aVal === undefined || aVal === null) return currentSort.direction === 'asc' ? 1 : -1;
                    if (bVal === undefined || bVal === null) return currentSort.direction === 'asc' ? -1 : 1;
                }


                if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
            
            sortedData.forEach(player => {
                const row = document.createElement('tr');
                row.className = 'bg-white border-b table-row-clickable';
                row.dataset.playerId = player.id;
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                        <div class="flex items-center">
                             <img src="${player.photoUrl || 'https://placehold.co/32x32/DDDDDD/555555?text=P'}" alt="${player.name}" class="w-8 h-8 rounded-full mr-3 object-cover">
                            <div>
                                ${player.name}
                                ${player.note ? `<span class="text-xs text-gray-500 block">${player.note}</span>` : ''}
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 hidden md:table-cell">${player.age}</td>
                    <td class="px-6 py-4">${player.appearances}</td>
                    <td class="px-6 py-4">${player.goals}</td>
                    <td class="px-6 py-4">${formatValue(player.value)}</td>
                `;
                tableBody.appendChild(row);
            });

            document.querySelectorAll('.table-row-clickable').forEach(row => {
                row.addEventListener('click', (e) => {
                    const playerId = e.currentTarget.dataset.playerId;
                    openPlayerModal(parseInt(playerId));
                });
            });
        }
        
        function openPlayerModal(playerId) {
            const player = AppData.squad.find(p => p.id === playerId);
            if (!player) return;

            const modal = document.getElementById('player-modal');
            const modalContent = modal.querySelector('.modal-content');
            const modalBody = document.getElementById('modal-body');
            document.getElementById('modal-player-name').textContent = player.name;
            
            let statsHtml;
            if (player.position === 'FW' || player.position === 'MF') {
                statsHtml = `
                    <div class="text-center font-semibold text-lg mb-2">Chỉ số tấn công & sáng tạo</div>
                    <div class="chart-container" style="height: 300px; max-height: 40vh;"><canvas id="playerRadarChart"></canvas></div>`;
            } else if (player.position === 'DF') {
                statsHtml = `
                    <div class="text-center font-semibold text-lg mb-2">Chỉ số phòng ngự</div>
                    <div class="chart-container" style="height: 300px; max-height: 40vh;"><canvas id="playerBarChart"></canvas></div>`;
            } else { // GK
                 statsHtml = `
                    <div class="text-center font-semibold text-lg mb-2">Thống kê thủ môn</div>
                    <div class="p-4 bg-slate-100 rounded-lg text-center">
                         <h4 class="font-medium text-slate-500">Số trận giữ sạch lưới</h4>
                         <p class="text-4xl font-bold text-slate-800 mt-2">${player.stats.cleanSheets !== undefined ? player.stats.cleanSheets : 'N/A'}</p>
                    </div>`;
            }

            modalBody.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-1 flex flex-col items-center">
                        <img src="${player.photoUrl || 'https://placehold.co/150x150/DDDDDD/555555?text=Player'}" alt="${player.name}" class="w-40 h-40 rounded-full mb-4 object-cover border-4 border-slate-200">
                        <div class="bg-white p-4 rounded-lg shadow-sm w-full">
                            <h4 class="font-bold text-lg mb-2 text-center">Thông tin chung</h4>
                            <div class="space-y-1 text-sm">
                                <p><strong class="font-semibold text-slate-600 w-28 inline-block">Vị trí:</strong> ${player.position}</p>
                                <p><strong class="font-semibold text-slate-600 w-28 inline-block">Tuổi:</strong> ${player.age}</p>
                                <p><strong class="font-semibold text-slate-600 w-28 inline-block">Quốc tịch:</strong> ${player.nationality}</p>
                                <p><strong class="font-semibold text-slate-600 w-28 inline-block">Hợp đồng:</strong> ${player.contractUntil}</p>
                                <p><strong class="font-semibold text-slate-600 w-28 inline-block">Số trận:</strong> ${player.appearances}</p>
                                <p><strong class="font-semibold text-slate-600 w-28 inline-block">Bàn thắng:</strong> ${player.goals}</p>
                                <p><strong class="font-semibold text-slate-600 w-28 inline-block">Kiến tạo:</strong> ${player.assists !== undefined ? player.assists : 'N/A'}</p>
                                <p><strong class="font-semibold text-slate-600 w-28 inline-block">Giá trị TT:</strong> €${formatValue(player.value)}M</p>
                                ${player.note ? `<p><strong class="font-semibold text-slate-600 w-28 inline-block">Ghi chú:</strong> ${player.note}</p>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="md:col-span-2 bg-white p-4 rounded-lg shadow-sm">
                         ${statsHtml}
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            setTimeout(() => {
                if (modal) modal.style.opacity = '1';
                if (modalContent) modalContent.style.transform = 'scale(1)';
            }, 10);
            
            if (charts.playerRadar) charts.playerRadar.destroy();
            if (charts.playerBar) charts.playerBar.destroy();
            
            const playerStats = player.stats || {};

            if (player.position === 'FW' || player.position === 'MF') {
                initPlayerRadarChart(player.name, playerStats);
            } else if (player.position === 'DF') {
                initPlayerBarChart(player.name, playerStats);
            }
        }

        function closeModal() {
            const modal = document.getElementById('player-modal');
            const modalContent = modal.querySelector('.modal-content');
            if (modal) modal.style.opacity = '0';
            if (modalContent) modalContent.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                if (modal) {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }
            }, 300);
        }

        function initCharts() {
            Chart.defaults.font.family = 'Inter';
            Chart.defaults.color = '#334155';
            
            const serieAChartElement = document.getElementById('serieAChart');
            if (serieAChartElement) {
                if(charts.serieA) charts.serieA.destroy();
                const serieA_ctx = serieAChartElement.getContext('2d');
                charts.serieA = new Chart(serieA_ctx, {
                    type: 'bar',
                    data: {
                        labels: AppData.performance.serieA.labels,
                        datasets: [{
                            label: 'Điểm số Serie A',
                            data: AppData.performance.serieA.points,
                            backgroundColor: [
                                'rgba(255, 159, 64, 0.5)',
                                'rgba(239, 68, 68, 0.5)',
                                'rgba(59, 130, 246, 0.5)',
                                'rgba(34, 197, 94, 0.5)',
                            ],
                            borderColor: [
                                'rgb(255, 159, 64)',
                                'rgb(239, 68, 68)',
                                'rgb(59, 130, 246)',
                                'rgb(34, 197, 94)',
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: 'So sánh điểm số cuối mùa' }
                        },
                        scales: { y: { beginAtZero: true, suggestedMax: 80 } }
                    }
                });
            }


            const revenueChartElement = document.getElementById('revenueChart');
            if (revenueChartElement) {
                if(charts.revenue) charts.revenue.destroy();
                const revenue_ctx = revenueChartElement.getContext('2d');
                charts.revenue = new Chart(revenue_ctx, {
                    type: 'doughnut',
                    data: {
                        labels: AppData.finance.revenue.labels,
                        datasets: [{
                            label: 'Cơ cấu doanh thu (€M)',
                            data: AppData.finance.revenue.data,
                            backgroundColor: [
                                'rgba(239, 68, 68, 0.7)',
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(245, 158, 11, 0.7)',
                            ],
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: true, text: 'Cơ cấu doanh thu 2023-2024' }
                        }
                    }
                });
            }
        }
        
        function initPlayerRadarChart(playerName, playerStats) {
            const ctx = document.getElementById('playerRadarChart').getContext('2d');
            const dataValues = [
                playerStats.goals || 0, 
                playerStats.assists || 0, 
                playerStats.xG || 0, 
                playerStats.xA || 0,
                (playerStats.keyPasses || 0) > 100 ? (playerStats.keyPasses / 10) : ((playerStats.keyPasses || 0) / 5)
            ];

            charts.playerRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Bàn thắng', 'Kiến tạo', 'xG', 'xA', 'Ch. Quyết định (scaled)'],
                    datasets: [{
                        label: playerName,
                        data: dataValues,
                        fill: true,
                        backgroundColor: 'rgba(239, 68, 68, 0.2)',
                        borderColor: 'rgb(239, 68, 68)',
                        pointBackgroundColor: 'rgb(239, 68, 68)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(239, 68, 68)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: { line: { tension: 0, borderWidth: 3 } },
                    scales: { r: { angleLines: { display: true }, suggestMin: 0, ticks: { display: true, backdropPadding:0, stepSize: Math.max(...dataValues) > 10 ? 5 : 2 } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function initPlayerBarChart(playerName, playerStats) {
             const ctx = document.getElementById('playerBarChart').getContext('2d');
             charts.playerBar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Tắc bóng', 'Cắt bóng', 'xA (scaled)'],
                    datasets: [{
                        label: 'Chỉ số phòng ngự',
                        data: [playerStats.tackles || 0, playerStats.interceptions || 0, (playerStats.xA || 0) * 10],
                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }
        
        function renderManagementTable() {
            const tableBody = document.getElementById('management-table-body');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            AppData.management.forEach(member => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${member.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${member.role}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${member.affiliation}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.app-section');
            const mobileNav = document.getElementById('mobile-nav');

            function switchTab(targetId) {
                sections.forEach(section => {
                    if (section.id === targetId) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });
                
                navLinks.forEach(link => {
                    if(link.dataset.target === targetId){
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
                
                if (targetId === 'performance' || targetId === 'off-pitch') {
                   initCharts(); 
                }
                if (targetId === 'off-pitch') {
                    renderManagementTable();
                }
                
                mobileNav.value = targetId; 
                window.scrollTo(0, 0); 
            }
            
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchTab(e.target.dataset.target);
                });
            });

            mobileNav.addEventListener('change', (e) => {
                switchTab(e.target.value);
            });

            document.getElementById('position-filter').addEventListener('change', (e) => {
                const position = e.target.value;
                const nameQuery = document.getElementById('name-search').value.toLowerCase();
                let filteredData = AppData.squad;

                if (position !== 'all') {
                    filteredData = filteredData.filter(p => p.position === position);
                }
                if (nameQuery) {
                    filteredData = filteredData.filter(p => p.name.toLowerCase().includes(nameQuery));
                }
                
                renderSquadTable(filteredData);
            });

             document.getElementById('name-search').addEventListener('input', (e) => {
                const nameQuery = e.target.value.toLowerCase();
                const position = document.getElementById('position-filter').value;
                let filteredData = AppData.squad;

                if (position !== 'all') {
                    filteredData = filteredData.filter(p => p.position === position);
                }
                if (nameQuery) {
                    filteredData = filteredData.filter(p => p.name.toLowerCase().includes(nameQuery));
                }
                
                renderSquadTable(filteredData);
            });
            
            document.querySelectorAll('.table-header-sortable').forEach(header => {
                header.addEventListener('click', (e) => {
                    const column = e.currentTarget.dataset.sort;
                    if(currentSort.column === column) {
                        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSort.column = column;
                        currentSort.direction = 'asc';
                    }
                    const position = document.getElementById('position-filter').value;
                    const nameQuery = document.getElementById('name-search').value.toLowerCase();
                    let filteredData = AppData.squad;
                    if (position !== 'all') {
                         filteredData = filteredData.filter(p => p.position === position);
                    }
                     if (nameQuery) {
                        filteredData = filteredData.filter(p => p.name.toLowerCase().includes(nameQuery));
                    }
                    renderSquadTable(filteredData);
                });
            });

            document.getElementById('close-modal-btn').addEventListener('click', closeModal);
            document.getElementById('player-modal').addEventListener('click', (e) => {
                if(e.target === e.currentTarget) {
                    closeModal();
                }
            });

            switchTab('overview'); 
            renderSquadTable(AppData.squad); 
            if (navLinks.length > 0) navLinks[0].classList.add('active'); 
        });
    </script>
</body>
</html>
