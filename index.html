<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AC Milan 2024-2025: Phân Tích Mùa Giải</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Visualization & Content Choices: 
        - Club Value/Player Value: Goal: Show change. Method: Line Chart (Chart.js). Interaction: Hover. Justification: Best for time-series data.
        - Revenue/Sponsorship Breakdown: Goal: Show proportions. Method: Donut Chart (Chart.js). Interaction: Hover. Justification: Clear for part-to-whole analysis.
        - Performance Overview: Goal: Compare. Method: Custom HTML/Tailwind trophy case. Interaction: Static visual. Justification: Provides a quick, impactful summary of the season's contrasting results.
        - Squad Data: Goal: Organize & Compare. Method: Filterable/Sortable HTML Table (JS). Interaction: Filter, Sort, Click for detail. Justification: The most effective method for exploring and comparing a large roster of players.
        - Detailed Player Stats: Goal: Organize & Compare metrics for one player. Method: Radar Chart (Chart.js). Interaction: Hover. Justification: Excellent for multivariate comparison on a single entity.
        - Coaching Timeline: Goal: Show change. Method: HTML/Tailwind diagram. Interaction: Static visual. Justification: Clearly illustrates instability.
        All visualizations are rendered on Canvas via Chart.js, with textual content presented in styled cards for context. -->
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 320px; max-height: 40vh; }
        @media (min-width: 768px) { .chart-container { height: 400px; } }
        .nav-link { transition: color 0.3s, border-color 0.3s; }
        .nav-link.active { color: #E53935; border-bottom-color: #E53935; }
        .nav-link:not(.active) { border-bottom-color: transparent; }
        .modal-backdrop { transition: opacity 0.3s ease-in-out; }
        .modal-content { transition: transform 0.3s ease-in-out; }
        .table-header-sortable { cursor: pointer; }
        .table-header-sortable:hover { background-color: #f0f0f0; }
        .table-row-clickable { cursor: pointer; transition: background-color 0.2s; }
        .table-row-clickable:hover { background-color: #fcebeb; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 flex items-center justify-center rounded-full bg-red-600 text-white font-bold text-sm">ACM</div>
                    <h1 class="text-lg md:text-xl font-bold text-slate-900">Milan 2024-25</h1>
                </div>
                <div class="hidden md:flex items-center space-x-2 md:space-x-4">
                    <a href="#overview" data-target="overview" class="nav-link text-sm md:text-base font-medium text-slate-600 hover:text-red-600 py-2 border-b-2">Tổng Quan</a>
                    <a href="#performance" data-target="performance" class="nav-link text-sm md:text-base font-medium text-slate-600 hover:text-red-600 py-2 border-b-2">Thành Tích</a>
                    <a href="#off-pitch" data-target="off-pitch" class="nav-link text-sm md:text-base font-medium text-slate-600 hover:text-red-600 py-2 border-b-2">Tài Chính & Hậu Trường</a>
                    <a href="#squad" data-target="squad" class="nav-link text-sm md:text-base font-medium text-slate-600 hover:text-red-600 py-2 border-b-2">Đội Hình</a>
                </div>
                <div class="md:hidden">
                    <select id="mobile-nav" class="bg-gray-200 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 block w-full p-2.5">
                        <option value="overview">Tổng Quan</option>
                        <option value="performance">Thành Tích</option>
                        <option value="off-pitch">Tài Chính & Hậu Trường</option>
                        <option value="squad">Đội Hình</option>
                    </select>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        
        <section id="overview" class="app-section space-y-8">
            <div>
                <h2 class="text-3xl font-bold text-slate-900">Mùa Giải Của Những Thái Cực</h2>
                <p class="mt-2 text-lg text-slate-600">Mùa giải 2024-2025 của AC Milan là một bức tranh phức tạp, nơi vinh quang tại các giải đấu cúp không thể che lấp đi nỗi thất vọng tại Serie A. Báo cáo này phân tích sâu về một năm đầy biến động của Rossoneri, từ sân cỏ đến phòng họp.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <h3 class="font-semibold text-slate-500">Vị trí Serie A</h3>
                    <p class="text-4xl font-bold text-red-700 mt-2">Hạng 8</p>
                    <p class="text-sm text-slate-500 mt-1">Không đủ điều kiện dự cúp Châu Âu</p>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <h3 class="font-semibold text-slate-500">Supercoppa Italiana</h3>
                    <p class="text-4xl font-bold text-green-600 mt-2">Vô Địch</p>
                    <p class="text-sm text-slate-500 mt-1">Đánh bại Inter Milan 3-2</p>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <h3 class="font-semibold text-slate-500">Vua Phá Lưới (Mọi Đấu Trường)</h3>
                    <p class="text-4xl font-bold text-slate-800 mt-2">17</p>
                    <p class="text-sm text-slate-500 mt-1">Christian Pulisic</p>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <h3 class="font-semibold text-slate-500">Giá Trị CLB (Forbes 2025)</h3>
                    <p class="text-4xl font-bold text-slate-800 mt-2">$1.5 tỷ</p>
                    <p class="text-sm text-green-600 mt-1">▲ 5% so với năm trước</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-2xl font-bold mb-4">Sự Tương Phản Của Mùa Giải</h3>
                <p class="mb-6 text-slate-600">Thành công ở các giải đấu cúp một trận và sự bất ổn trong cuộc đua đường dài ở giải VĐQG đã định hình nên một mùa giải khó đoán của Milan. Đội bóng có thể thi đấu thăng hoa trong các trận đấu knock-out nhưng lại thiếu đi sự nhất quán cần thiết để cạnh tranh cho Scudetto, dẫn đến sự hụt hẫng lớn cho người hâm mộ.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="border-l-4 border-green-500 pl-4">
                        <h4 class="font-bold text-xl text-green-600">Điểm Sáng</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1 text-slate-700">
                            <li>Vô địch Supercoppa Italiana lần thứ 8.</li>
                            <li>Lọt vào chung kết Coppa Italia.</li>
                            <li>Christian Pulisic và Tijjani Reijnders tỏa sáng.</li>
                            <li>Tiếp tục trao cơ hội cho các tài năng trẻ.</li>
                        </ul>
                    </div>
                    <div class="border-l-4 border-red-500 pl-4">
                        <h4 class="font-bold text-xl text-red-600">Nỗi Thất Vọng</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1 text-slate-700">
                            <li>Chỉ kết thúc ở vị trí thứ 8 tại Serie A.</li>
                            <li>Bị loại sớm khỏi Champions League.</li>
                            <li>Thua chung kết Coppa Italia trước Bologna.</li>
                            <li>Bất ổn trên băng ghế huấn luyện.</li>
                        </ul>
                    </div>
                </div>
            </div>

        </section>

        <section id="performance" class="app-section space-y-8 hidden">
             <div>
                <h2 class="text-3xl font-bold text-slate-900">Phân Tích Thành Tích</h2>
                <p class="mt-2 text-lg text-slate-600">Khám phá hành trình của AC Milan qua bốn đấu trường chính trong mùa giải 2024-2025: từ vinh quang cúp quốc nội đến sự sa sút ở giải VĐQG và đấu trường châu Âu.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-1">Serie A: Mùa Giải Đầy Thử Thách</h3>
                    <p class="text-slate-600 mb-4">Kết thúc ở vị trí thứ 8 với 63 điểm là một kết quả đáng thất vọng, cho thấy sự thiếu ổn định nghiêm trọng trong suốt 38 vòng đấu.</p>
                    <div class="chart-container">
                        <canvas id="serieAChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-4">Champions League: Dừng Bước Sớm</h3>
                    <p class="text-slate-600 mb-4">Dù đã vượt qua vòng bảng, Milan đã bị Feyenoord loại ở vòng play-off, một kết quả dưới kỳ vọng cho một CLB giàu truyền thống châu Âu.</p>
                    <div class="flex flex-col space-y-4">
                        <div class="text-center p-4 bg-slate-100 rounded-lg">
                            <p class="font-semibold text-slate-500">Giai đoạn</p>
                            <p class="text-xl font-bold text-slate-800">Vòng Play-off Đấu loại trực tiếp</p>
                        </div>
                        <div class="text-center p-4 bg-red-50 rounded-lg">
                            <p class="font-semibold text-red-500">Kết quả</p>
                            <p class="text-xl font-bold text-red-800">Bị loại bởi Feyenoord (Tổng tỷ số 1-2)</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-4">Coppa Italia: Hành Trình Đến Chung Kết</h3>
                     <p class="text-slate-600 mb-4">Milan đã thể hiện bản lĩnh ở các trận đấu loại trực tiếp, vượt qua các đối thủ mạnh để vào chung kết, nhưng lại gục ngã ở ngưỡng cửa thiên đường.</p>
                    <div class="relative w-full">
                        <div class="absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-300"></div>
                        <div class="space-y-4">
                            <div class="text-center relative"> <span class="bg-white px-2 z-10 relative">Vòng 16: vs Sassuolo <b class="text-green-600"> (6-1)</b></span></div>
                            <div class="text-center relative"> <span class="bg-white px-2 z-10 relative">Tứ kết: vs Roma <b class="text-green-600"> (3-1)</b></span></div>
                            <div class="text-center relative"> <span class="bg-white px-2 z-10 relative">Bán kết: vs Inter <b class="text-green-600"> (4-1)</b></span></div>
                            <div class="text-center relative"> <span class="bg-white px-2 z-10 relative">Chung kết: vs Bologna <b class="text-red-600"> (0-1)</b></span></div>
                        </div>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-4">Supercoppa Italiana: Tia Sáng An Ủi</h3>
                    <p class="text-slate-600 mb-4">Chiến thắng thuyết phục trước đại kình địch Inter Milan đã mang về danh hiệu duy nhất của mùa giải, một niềm vui hiếm hoi cho các Milanista.</p>
                     <div class="flex flex-col items-center justify-center h-full">
                        <div class="text-yellow-500">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM5.05 4.3a.75.75 0 011.06-1.06l1.062 1.062a.75.75 0 11-1.06 1.06L5.05 4.3zM14.95 4.3a.75.75 0 010 1.06l-1.062 1.062a.75.75 0 11-1.06-1.06L14.95 4.3zM2 10a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5A.75.75 0 012 10zm15.25.75a.75.75 0 000-1.5h-1.5a.75.75 0 000 1.5h1.5zM5.05 15.7a.75.75 0 10-1.06-1.06L3.06 15.71a.75.75 0 101.06 1.06l.932-.932zM14.95 15.7a.75.75 0 001.06-1.06l-.932-.932a.75.75 0 00-1.06 1.06l.932.932zM10 15.25a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5a.75.75 0 01.75-.75z" clip-rule="evenodd" /><path d="M7 10a3 3 0 116 0 3 3 0 01-6 0zm3-4a4 4 0 100 8 4 4 0 000-8z" /></svg>
                        </div>
                        <p class="text-3xl font-bold text-slate-800 mt-4">VÔ ĐỊCH</p>
                        <p class="text-lg text-slate-500">Đánh bại Inter 3-2</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="off-pitch" class="app-section space-y-8 hidden">
            <div>
                <h2 class="text-3xl font-bold text-slate-900">Tài Chính & Hậu Trường</h2>
                <p class="mt-2 text-lg text-slate-600">Những biến động trên sân cỏ song hành cùng các vấn đề về tài chính và mối quan hệ căng thẳng với người hâm mộ. Khám phá những động lực ngoài sân cỏ định hình mùa giải của Milan.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-1">Sức Khỏe Kinh Tế</h3>
                    <p class="text-slate-600 mb-4">Dù giá trị CLB tăng, việc không được dự cúp Châu Âu mùa tới sẽ tạo ra áp lực tài chính lớn, dự kiến gây thâm hụt đáng kể.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="p-4 bg-slate-100 rounded-lg">
                            <h4 class="font-medium text-slate-500">Doanh thu 2023-24</h4>
                            <p class="text-2xl font-bold text-slate-800">€397.6M</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg">
                            <h4 class="font-medium text-red-500">Lỗ dự kiến 24-25</h4>
                            <p class="text-2xl font-bold text-red-700">~ €25M</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold mb-1">Mối Quan Hệ với Người Hâm Mộ</h3>
                    <p class="text-slate-600 mb-4">Sự bất mãn lên đến đỉnh điểm với các cuộc biểu tình của Curva Sud nhắm vào chủ sở hữu RedBird, phản ánh sự mất kết nối giữa CĐV và ban lãnh đạo.</p>
                    <blockquote class="border-l-4 border-black pl-4 py-2 bg-gray-100">
                        <p class="text-xl font-semibold italic text-slate-800">"Go Home"</p>
                        <footer class="text-slate-600 mt-2">— Thông điệp từ các Ultras trong trận đấu cuối cùng của mùa giải.</footer>
                    </blockquote>
                    <h4 class="font-semibold mt-6 mb-2">Các bất bình chính:</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-700">
                        <li>Thành tích mùa giải đáng thất vọng.</li>
                        <li>Thiếu đầu tư và tham vọng rõ ràng từ chủ sở hữu.</li>
                        <li>Sa thải huyền thoại Paolo Maldini.</li>
                        <li>Sự mất kết nối với bản sắc CLB.</li>
                    </ul>
                </div>
            </div>
             <div class="bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-2xl font-bold mb-4">Ban Huấn Luyện: Chiếc Ghế Nóng</h3>
                 <p class="text-slate-600 mb-6">Sự bất ổn ở vị trí HLV là một trong những nguyên nhân chính dẫn đến thành tích kém cỏi. Việc thay tướng giữa dòng và công bố HLV mới cho mùa sau ngay lập tức cho thấy sự thiếu kiên nhẫn và tầm nhìn dài hạn.</p>
                <div class="relative flex items-center justify-between w-full text-center">
                    <div class="absolute top-1/2 left-0 w-full h-0.5 bg-gray-300 transform -translate-y-1/2"></div>
                    <div class="relative text-center">
                        <div class="w-24 h-24 mx-auto bg-gray-200 rounded-full flex items-center justify-center border-4 border-white"><div class="text-center"><b class="block">Paulo Fonseca</b><span class="text-xs">Đầu mùa</span></div></div>
                    </div>
                    <div class="relative text-center">
                        <div class="w-24 h-24 mx-auto bg-gray-200 rounded-full flex items-center justify-center border-4 border-white"><div class="text-center"><b class="block">Sérgio Conceição</b><span class="text-xs">30/12/2024</span></div></div>
                    </div>
                    <div class="relative text-center">
                        <div class="w-24 h-24 mx-auto bg-red-600 text-white rounded-full flex items-center justify-center border-4 border-white"><div class="text-center"><b class="block">M. Allegri</b><span class="text-xs">Mùa 2025/26</span></div></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="squad" class="app-section space-y-8 hidden">
            <div>
                <h2 class="text-3xl font-bold text-slate-900">Phân Tích Đội Hình</h2>
                <p class="mt-2 text-lg text-slate-600">Khám phá chi tiết từng cầu thủ trong đội hình AC Milan mùa giải 2024-2025. Sử dụng bộ lọc để xem theo vị trí và sắp xếp theo các chỉ số khác nhau. Nhấp vào một cầu thủ để xem phân tích sâu hơn.</p>
            </div>
            <div class="bg-white p-4 sm:p-6 rounded-xl shadow-md">
                <div class="flex flex-col sm:flex-row items-center justify-between mb-4 gap-4">
                    <div class="w-full sm:w-auto">
                        <label for="position-filter" class="text-sm font-medium text-slate-700 mr-2">Lọc theo vị trí:</label>
                        <select id="position-filter" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 p-2">
                            <option value="all">Tất cả</option>
                            <option value="GK">Thủ môn (GK)</option>
                            <option value="DF">Hậu vệ (DF)</option>
                            <option value="MF">Tiền vệ (MF)</option>
                            <option value="FW">Tiền đạo (FW)</option>
                        </select>
                    </div>
                     <div class="w-full sm:w-auto">
                        <input type="text" id="name-search" placeholder="Tìm kiếm theo tên..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 p-2 w-full">
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-slate-500">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                            <tr>
                                <th scope="col" class="px-6 py-3 table-header-sortable" data-sort="name">Cầu thủ</th>
                                <th scope="col" class="px-6 py-3 table-header-sortable hidden md:table-cell" data-sort="age">Tuổi</th>
                                <th scope="col" class="px-6 py-3 table-header-sortable" data-sort="appearances">Số trận</th>
                                <th scope="col" class="px-6 py-3 table-header-sortable" data-sort="goals">Bàn thắng</th>
                                <th scope="col" class="px-6 py-3 table-header-sortable" data-sort="value">Giá trị TT (€M)</th>
                            </tr>
                        </thead>
                        <tbody id="squad-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <div id="player-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center hidden modal-backdrop">
        <div class="bg-slate-50 rounded-xl shadow-2xl w-11/12 max-w-4xl max-h-[90vh] overflow-y-auto m-8 modal-content transform scale-95">
            <div class="sticky top-0 bg-slate-50 p-4 border-b border-slate-200 flex justify-between items-center z-10">
                <h3 id="modal-player-name" class="text-2xl font-bold"></h3>
                <button id="close-modal-btn" class="text-slate-500 hover:text-slate-800 text-3xl leading-none">&times;</button>
            </div>
            <div id="modal-body" class="p-6 space-y-6">
            </div>
        </div>
    </div>

    <script>
        const AppData = {
            squad: [
                { id: 1, name: 'Mike Maignan', position: 'GK', age: 29, appearances: 53, goals: 0, assists: 0, value: 25.0, stats: {cleanSheets: 15}, valueHistory: [45, 40, 35, 25] },
                { id: 2, name: 'Théo Hernandez', position: 'DF', age: 27, appearances: 49, goals: 5, assists: 4, value: 40.0, stats: {tackles: 60, interceptions: 35, xA: 5.34}, valueHistory: [50, 60, 55, 40] },
                { id: 3, name: 'Fikayo Tomori', position: 'DF', age: 27, appearances: 36, goals: 0, assists: 2, value: 20.0, stats: {tackles: 55, interceptions: 45, xA: 0.43}, valueHistory: [45, 50, 40, 20] },
                { id: 4, name: 'Tijjani Reijnders', position: 'MF', age: 26, appearances: 54, goals: 15, assists: 6, value: 50.0, stats: {goals: 15, assists: 6, xG: 7.5, xA: 5.0, keyPasses: 117}, valueHistory: [22, 30, 40, 50] },
                { id: 5, name: 'Christian Pulisic', position: 'FW', age: 26, appearances: 50, goals: 17, assists: 11, value: 50.0, stats: {goals: 17, assists: 11, xG: 12.0, xA: 6.4, keyPasses: 60}, valueHistory: [40, 38, 42, 50] },
                { id: 6, name: 'Rafael Leão', position: 'FW', age: 25, appearances: 49, goals: 12, assists: 9, value: 75.0, stats: {goals: 12, assists: 9, xG: 7.6, xA: 8.4, keyPasses: 70}, valueHistory: [70, 85, 80, 75] },
                { id: 7, name: 'Ruben Loftus-Cheek', position: 'MF', age: 29, appearances: 28, goals: 0, assists: 0, value: 16.0, stats: {goals: 0, assists: 0, xG: 0.7, xA: 1.9, keyPasses: 20}, valueHistory: [25, 20, 18, 16] },
                { id: 8, name: 'Youssouf Fofana', position: 'MF', age: 25, appearances: 52, goals: 1, assists: 8, value: 30.0, stats: {goals: 1, assists: 8, xG: 1.5, xA: 4.0, keyPasses: 45}, valueHistory: [25, 28, 30, 30] },
                { id: 9, name: 'Santiago Giménez', position: 'FW', age: 24, appearances: 19, goals: 6, assists: 3, value: 37.0, stats: {goals: 6, assists: 3, xG: 4.8, xA: 0.9, keyPasses: 15}, valueHistory: [25, 40, 45, 37] },
                { id: 10, name: 'Malick Thiaw', position: 'DF', age: 23, appearances: 31, goals: 1, assists: 0, value: 20.0, stats: {tackles: 40, interceptions: 30, xA: 0.2}, valueHistory: [20, 30, 25, 20] },
                { id: 11, name: 'Samuel Chukwueze', position: 'FW', age: 26, appearances: 36, goals: 5, assists: 0, value: 14.0, stats: {goals: 5, assists: 0, xG: 4.5, xA: 1.5, keyPasses: 25}, valueHistory: [25, 20, 18, 14] },
                { id: 12, name: 'Tammy Abraham', position: 'FW', age: 27, appearances: 44, goals: 10, assists: 0, value: 15.0, stats: {goals: 10, assists: 0, xG: 12.5, xA: 2.1, keyPasses: 20}, valueHistory: [40, 35, 25, 15] },
            ],
            performance: {
                serieA: {
                    labels: ['Top 4 Target', 'AC Milan', 'Atalanta', 'Bologna'],
                    points: [71, 63, 69, 68]
                }
            },
            finance: {
                revenue: {
                    labels: ['Thương mại (44%)', 'Bản quyền TH (38%)', 'Ngày thi đấu (18%)'],
                    data: [174.9, 151.1, 71.6]
                }
            }
        };

        let currentSort = { column: 'name', direction: 'asc' };
        let charts = {};

        function formatValue(value) {
            return value.toFixed(1);
        }
        
        function renderSquadTable(squadData) {
            const tableBody = document.getElementById('squad-table-body');
            tableBody.innerHTML = '';

            const sortedData = [...squadData].sort((a, b) => {
                let aVal = a[currentSort.column];
                let bVal = b[currentSort.column];
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
            
            sortedData.forEach(player => {
                const row = document.createElement('tr');
                row.className = 'bg-white border-b table-row-clickable';
                row.dataset.playerId = player.id;
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-2.5 h-2.5 rounded-full mr-2 ${
                                player.position === 'GK' ? 'bg-yellow-400' :
                                player.position === 'DF' ? 'bg-blue-500' :
                                player.position === 'MF' ? 'bg-green-500' : 'bg-red-500'
                            }"></div>
                            ${player.name}
                        </div>
                    </td>
                    <td class="px-6 py-4 hidden md:table-cell">${player.age}</td>
                    <td class="px-6 py-4">${player.appearances}</td>
                    <td class="px-6 py-4">${player.goals}</td>
                    <td class="px-6 py-4">${formatValue(player.value)}</td>
                `;
                tableBody.appendChild(row);
            });

            document.querySelectorAll('.table-row-clickable').forEach(row => {
                row.addEventListener('click', (e) => {
                    const playerId = e.currentTarget.dataset.playerId;
                    openPlayerModal(parseInt(playerId));
                });
            });
        }
        
        function openPlayerModal(playerId) {
            const player = AppData.squad.find(p => p.id === playerId);
            if (!player) return;

            const modal = document.getElementById('player-modal');
            const modalContent = modal.querySelector('.modal-content');
            const modalBody = document.getElementById('modal-body');
            document.getElementById('modal-player-name').textContent = player.name;
            
            let statsHtml;
            if (player.position === 'FW' || player.position === 'MF') {
                statsHtml = `
                    <div class="text-center font-semibold text-lg mb-2">Chỉ số tấn công & sáng tạo</div>
                    <div class="chart-container" style="height: 300px; max-height: 40vh;"><canvas id="playerRadarChart"></canvas></div>`;
            } else if (player.position === 'DF') {
                statsHtml = `
                    <div class="text-center font-semibold text-lg mb-2">Chỉ số phòng ngự</div>
                    <div class="chart-container" style="height: 300px; max-height: 40vh;"><canvas id="playerBarChart"></canvas></div>`;
            } else { // GK
                 statsHtml = `
                    <div class="text-center font-semibold text-lg mb-2">Thống kê thủ môn</div>
                    <div class="p-4 bg-slate-100 rounded-lg text-center">
                         <h4 class="font-medium text-slate-500">Số trận giữ sạch lưới</h4>
                         <p class="text-4xl font-bold text-slate-800 mt-2">${player.stats.cleanSheets}</p>
                    </div>`;
            }

            modalBody.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <h4 class="font-bold text-lg mb-4">Thông tin chung</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong class="font-semibold text-slate-600 w-24 inline-block">Vị trí:</strong> ${player.position}</p>
                                <p><strong class="font-semibold text-slate-600 w-24 inline-block">Tuổi:</strong> ${player.age}</p>
                                <p><strong class="font-semibold text-slate-600 w-24 inline-block">Số trận:</strong> ${player.appearances}</p>
                                <p><strong class="font-semibold text-slate-600 w-24 inline-block">Bàn thắng:</strong> ${player.goals}</p>
                                <p><strong class="font-semibold text-slate-600 w-24 inline-block">Kiến tạo:</strong> ${player.assists}</p>
                                <p><strong class="font-semibold text-slate-600 w-24 inline-block">Giá trị TT:</strong> €${formatValue(player.value)}M</p>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm mt-6">
                             <h4 class="font-bold text-lg mb-2">Lịch sử giá trị chuyển nhượng (€M)</h4>
                             <div class="chart-container" style="height: 200px; max-height: 30vh;"><canvas id="playerValueChart"></canvas></div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                         ${statsHtml}
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            setTimeout(() => {
                if (modal) modal.style.opacity = '1';
                if (modalContent) modalContent.style.transform = 'scale(1)';
            }, 10);
            
            if (charts.playerRadar) charts.playerRadar.destroy();
            if (charts.playerBar) charts.playerBar.destroy();
            if (charts.playerValue) charts.playerValue.destroy();

            if (player.position === 'FW' || player.position === 'MF') {
                initPlayerRadarChart(player);
            } else if (player.position === 'DF') {
                initPlayerBarChart(player);
            }
            initPlayerValueChart(player);
        }

        function closeModal() {
            const modal = document.getElementById('player-modal');
            const modalContent = modal.querySelector('.modal-content');
            if (modal) modal.style.opacity = '0';
            if (modalContent) modalContent.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                if (modal) {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }
            }, 300);
        }

        function initCharts() {
            Chart.defaults.font.family = 'Inter';
            Chart.defaults.color = '#334155';
            
            const serieAChartElement = document.getElementById('serieAChart');
            if (serieAChartElement) {
                if(charts.serieA) charts.serieA.destroy();
                const serieA_ctx = serieAChartElement.getContext('2d');
                charts.serieA = new Chart(serieA_ctx, {
                    type: 'bar',
                    data: {
                        labels: AppData.performance.serieA.labels,
                        datasets: [{
                            label: 'Điểm số Serie A',
                            data: AppData.performance.serieA.points,
                            backgroundColor: [
                                'rgba(255, 159, 64, 0.5)',
                                'rgba(239, 68, 68, 0.5)',
                                'rgba(59, 130, 246, 0.5)',
                                'rgba(34, 197, 94, 0.5)',
                            ],
                            borderColor: [
                                'rgb(255, 159, 64)',
                                'rgb(239, 68, 68)',
                                'rgb(59, 130, 246)',
                                'rgb(34, 197, 94)',
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: 'So sánh điểm số cuối mùa' }
                        },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            }


            const revenueChartElement = document.getElementById('revenueChart');
            if (revenueChartElement) {
                if(charts.revenue) charts.revenue.destroy();
                const revenue_ctx = revenueChartElement.getContext('2d');
                charts.revenue = new Chart(revenue_ctx, {
                    type: 'doughnut',
                    data: {
                        labels: AppData.finance.revenue.labels,
                        datasets: [{
                            label: 'Cơ cấu doanh thu (€M)',
                            data: AppData.finance.revenue.data,
                            backgroundColor: [
                                'rgba(239, 68, 68, 0.7)',
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(245, 158, 11, 0.7)',
                            ],
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: true, text: 'Cơ cấu doanh thu 2023-2024' }
                        }
                    }
                });
            }
        }
        
        function initPlayerRadarChart(player) {
            const ctx = document.getElementById('playerRadarChart').getContext('2d');
            charts.playerRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Bàn thắng', 'Kiến tạo', 'Bàn thắng kỳ vọng (xG)', 'Kiến tạo kỳ vọng (xA)', 'Đường chuyền quyết định'],
                    datasets: [{
                        label: player.name,
                        data: [
                            player.stats.goals, 
                            player.stats.assists, 
                            player.stats.xG, 
                            player.stats.xA,
                            player.stats.keyPasses > 100 ? player.stats.keyPasses / 10 : player.stats.keyPasses / 5 
                        ],
                        fill: true,
                        backgroundColor: 'rgba(239, 68, 68, 0.2)',
                        borderColor: 'rgb(239, 68, 68)',
                        pointBackgroundColor: 'rgb(239, 68, 68)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(239, 68, 68)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: { line: { tension: 0, borderWidth: 3 } },
                    scales: { r: { angleLines: { display: false }, suggestMin: 0, ticks: { display: false } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function initPlayerBarChart(player) {
             const ctx = document.getElementById('playerBarChart').getContext('2d');
             charts.playerBar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Tắc bóng', 'Cắt bóng', 'Kiến tạo kỳ vọng (xA)'],
                    datasets: [{
                        label: 'Chỉ số phòng ngự',
                        data: [player.stats.tackles, player.stats.interceptions, player.stats.xA * 10], // Scaled xA for better visualization
                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }
        
        function initPlayerValueChart(player) {
            const ctx = document.getElementById('playerValueChart').getContext('2d');
            charts.playerValue = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2022', '2023', '2024', '2025'],
                    datasets: [{
                        label: 'Giá trị thị trường',
                        data: player.valueHistory,
                        fill: false,
                        borderColor: 'rgb(34, 197, 94)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: false } }
                }
            });
        }


        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.app-section');
            const mobileNav = document.getElementById('mobile-nav');

            function switchTab(targetId) {
                sections.forEach(section => {
                    if (section.id === targetId) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });
                
                navLinks.forEach(link => {
                    if(link.dataset.target === targetId){
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
                
                if (targetId === 'performance' || targetId === 'off-pitch') {
                   initCharts(); // Initialize charts only when these tabs are active
                }
                
                mobileNav.value = targetId; // Sync mobile nav
                window.scrollTo(0, 0); // Scroll to top
            }
            
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchTab(e.target.dataset.target);
                });
            });

            mobileNav.addEventListener('change', (e) => {
                switchTab(e.target.value);
            });

            document.getElementById('position-filter').addEventListener('change', (e) => {
                const position = e.target.value;
                const nameQuery = document.getElementById('name-search').value.toLowerCase();
                let filteredData = AppData.squad;

                if (position !== 'all') {
                    filteredData = filteredData.filter(p => p.position === position);
                }
                if (nameQuery) {
                    filteredData = filteredData.filter(p => p.name.toLowerCase().includes(nameQuery));
                }
                
                renderSquadTable(filteredData);
            });

             document.getElementById('name-search').addEventListener('input', (e) => {
                const nameQuery = e.target.value.toLowerCase();
                const position = document.getElementById('position-filter').value;
                let filteredData = AppData.squad;

                if (position !== 'all') {
                    filteredData = filteredData.filter(p => p.position === position);
                }
                if (nameQuery) {
                    filteredData = filteredData.filter(p => p.name.toLowerCase().includes(nameQuery));
                }
                
                renderSquadTable(filteredData);
            });
            
            document.querySelectorAll('.table-header-sortable').forEach(header => {
                header.addEventListener('click', (e) => {
                    const column = e.currentTarget.dataset.sort;
                    if(currentSort.column === column) {
                        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSort.column = column;
                        currentSort.direction = 'asc';
                    }
                    // Re-filter and render
                    const position = document.getElementById('position-filter').value;
                    const nameQuery = document.getElementById('name-search').value.toLowerCase();
                    let filteredData = AppData.squad;
                    if (position !== 'all') {
                         filteredData = filteredData.filter(p => p.position === position);
                    }
                     if (nameQuery) {
                        filteredData = filteredData.filter(p => p.name.toLowerCase().includes(nameQuery));
                    }
                    renderSquadTable(filteredData);
                });
            });

            document.getElementById('close-modal-btn').addEventListener('click', closeModal);
            document.getElementById('player-modal').addEventListener('click', (e) => {
                // Close if clicked on backdrop
                if(e.target === e.currentTarget) {
                    closeModal();
                }
            });

            // Initial setup
            switchTab('overview'); // Default to overview tab
            renderSquadTable(AppData.squad); // Render initial squad table
            if (navLinks.length > 0) navLinks[0].classList.add('active'); // Set first nav link active
        });
    </script>
</body>
</html>
